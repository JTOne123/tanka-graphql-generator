<?xml version="1.0" encoding="utf-8" ?>
<Project
	xmlns="http://schemas.microsoft.com/developer/msbuild/2003">

	<UsingTask AssemblyFile="$(TankaSchemaTaskAssembly)" TaskName="SchemaGenerator"/>

	<ItemGroup>
		<PropertyPageSchema Include="$(MSBuildThisFileDirectory)Tanka.GraphQL.Generator.xaml" />
		<PropertyPageSchema Include="$(MSBuildThisFileDirectory)Tanka.GraphQL.Generator.ContentType.xaml" />
    <AvailableItemName Include="TankaSchema"/>
	</ItemGroup>

	<PropertyGroup>
    <GenerateTankaSchemaDependsOn>
      $(GenerateTankaSchemaDependsOn);
      ResolveReferences;
		</GenerateTankaSchemaDependsOn>		
		
	</PropertyGroup>
	
	<Target 
		Name="GenerateTankaSchema" 
    DependsOnTargets="$(GenerateTankaSchemaDependsOn)"
		BeforeTargets="CoreCompile;PrepareResources"
		Condition="'@(TankaSchema)' != ''"
	>

		<PropertyGroup>
			<CodeGenerationRoot>$(MSBuildProjectDirectory)\$(IntermediateOutputPath)</CodeGenerationRoot>
		</PropertyGroup>

		<!--<ItemGroup>
			<TankaSchemaTemp Include="@(TankaSchema)"/>
			<TankaSchema Remove="@(TankaSchema)"/>
		</ItemGroup>
  -->
		<SchemaGenerator
      Command="$(TankaGeneratorToolCommand)"
			OutputPath="$(CodeGenerationRoot)"
			InputFiles="@(TankaSchema)"
      RootNamespace="$(RootNamespace)"
		>
			<Output TaskParameter="OutputFiles" ItemName="SchemaCode"/>
    </SchemaGenerator>

		<ItemGroup>
			<Compile Include="@(SchemaCode)"/>
		</ItemGroup>
		
	</Target>

</Project>